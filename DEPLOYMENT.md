# Инструкция по настройке автоматической публикации

## Настройка GitHub Actions для автоматической публикации в PyPI

### Шаг 1: Создание API токена PyPI

1. Зайдите на [PyPI](https://pypi.org/) и войдите в свой аккаунт
2. Перейдите в **Account settings** → **API tokens**
3. Нажмите **Add API token**
4. Выберите **Entire account (all projects)**
5. Скопируйте созданный токен

### Шаг 2: Настройка GitHub Secrets

1. Перейдите в ваш GitHub репозиторий
2. Нажмите **Settings** → **Secrets and variables** → **Actions**
3. Нажмите **New repository secret**
4. Создайте секрет с именем `PYPI_API_TOKEN` и значением вашего PyPI токена

### Шаг 3: Настройка Environment

1. В том же разделе **Secrets and variables** → **Actions**
2. Перейдите на вкладку **Environments**
3. Нажмите **New environment**
4. Назовите среду `pypi`
5. В разделе **Environment protection rules** можете добавить правила (опционально)

### Шаг 4: Публикация новой версии

Теперь для публикации новой версии достаточно:

1. Обновить версию в `onlinesimru/_version.py`
2. Обновить `CHANGELOG.md`
3. Зафиксировать изменения:
   ```bash
   git add .
   git commit -m "Bump version to X.X.X"
   ```
4. Запустить деплой:
   ```bash
   ./deploy.sh
   ```

### Что происходит автоматически:

1. **Создается git тег** с версией
2. **GitHub Actions запускается** при пуше тега
3. **Собирается пакет** с помощью modern Python tools
4. **Загружается в PyPI** с использованием вашего API токена
5. **Создается GitHub Release** с собранными файлами

### Преимущества этого подхода:

- ✅ **Безопасность**: API токен хранится в GitHub Secrets
- ✅ **Автоматизация**: Не нужно вручную собирать и загружать
- ✅ **Современность**: Использует современные инструменты сборки
- ✅ **Аудит**: Все действия логируются в GitHub Actions
- ✅ **Контроль**: Можно настроить правила для environment

### Troubleshooting

Если что-то пошло не так:

1. Проверьте логи в **Actions** → **Publish to PyPI**
2. Убедитесь, что `PYPI_API_TOKEN` правильно настроен
3. Проверьте, что environment `pypi` создан
4. Убедитесь, что тег создан в правильном формате (`v*`)

### Альтернативный способ (локальная сборка)

Если нужно собрать пакет локально:

```bash
# Установить зависимости
pip install build twine

# Собрать пакет
python -m build --wheel --sdist

# Загрузить в PyPI (требует настройки ~/.pypirc)
python -m twine upload dist/*
```
